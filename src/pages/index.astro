---
import MainPageLayout from '@layouts/MainPageLayout.astro';
import Cover from '@components/Cover.astro';
import PostCard from '@components/PostCard.astro';
import { getCollection, render } from 'astro:content'
import { url_blog_cover } from '@utils/url-utils'

import { siteConfig } from '@/config';

const pageTitle = `${siteConfig.title} - ${siteConfig.subTitle}`;
const coverEnabled = siteConfig.cover.enabled;

// export async function getStaticPaths() {
//     const blogEntries = await getCollection('blog', ({ data }) => {
//         return import.meta.env.PROD ? data.draft !== true : true
//     })
//     return blogEntries.map(entry => ({
//         // params: { slug: entry.id }, // 在Astro5.0中，params.slug被弃用，改为params.id
//         props: { entry },
//     }))
// }

// // const { slug } = Astro.params;
// const { entry } = Astro.props;
// const { Content, headings } = await render(entry); // 获取渲染后的正文内容

const blogEntries = (await getCollection('blog', ({ data }) => {
    return import.meta.env.PROD ? data.draft !== true : true
})).sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<MainPageLayout title={pageTitle}>
    {coverEnabled && <Cover />}
    {
        blogEntries.map(entry => (
            <PostCard title={entry.data.title} description={entry.data.description} 
                      image={url_blog_cover(entry.data.image, entry.id)} pubDate={entry.data.pubDate.toLocaleDateString('en-CA')}
                      url={entry.id}/>
        ))
    }
</MainPageLayout>